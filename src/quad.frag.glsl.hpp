static const char *g_shader_fragment_quad = ""
#if defined(USE_LD)
"quad.frag.glsl"
#else
"#version 430\n"
"layout(location=0)uniform sampler2D t;"
"layout(location=1)uniform sampler3D u;"
"layout(location=2)uniform vec3[10] v;"
"mat3 m=mat3(.42f,-.7f,.58f,.53f,.71f,.46f,-.74f,.12f,.67f);"
"out vec4 o;"
"vec4 D=vec4(.3,.0,.7,.009);"
"vec3 L=normalize(vec3(2.,.5,-1.));"
"float l=v[9].g;"
"bool w=1.<abs(v[7].b);"
"float f(vec3 p)"
"{"
"float a,b,c,r;"
"vec3 h,i,j,k;"
"if(w)"
"{"
"h=p*.02;"
"vec4 r=vec4(h,1);"
"for(int i=0;"
"i<9;"
"i++)"
"{"
"r.rgb=clamp(r.rgb,-1.,1.)*2.-r.rgb;"
"c=dot(r.rgb,r.rgb);"
"r*=clamp(max(.824/c,.824),.0,1.);"
"r=r*vec4(vec3(-2.742),2.742)+vec4(h,1.);"
"}"
"r.rgb*=clamp(h.g+1,.1,1.);"
"c=((length(r.rgb)-3.259)/r.a-.001475)*50.;"
"}"
"else"
"{"
"h=m*p*.007;"
"i=m*h*2.61;"
"j=m*i*2.11;"
"k=m*j*2.11;"
"a=texture(t,h.rb).r*2.61;"
"b=texture(t,i.rb).r*1.77;"
"c=texture(t,j.rb).r*.11;"
"r=texture(t,k.rb).r*.11;"
"a=r+c+pow(a,2.)+pow(b,2.);"
"c=length(p.rb)*.3;"
"c=a*(smoothstep(.0,.5,c*.0025)+.5)+p.g-6.*((sin(clamp(pow(c/10.,1.8)-3.14/2.,-1.57,1.57))-1.)*2.+5.)*cos(clamp(.04*c,.0,3.14));"
"}"
"h=p-v[8].rgb;"
"a=length(h);"
"if(a<l)return c+l-a;"
"return c;"
"}"
"float T(vec3 p,vec3 d,float I,out vec3 P,out vec3 N)"
"{"
"vec3 n,r;"
"float a=f(p),c,e,i=1.;"
"for(;"
"i>.0;"
"i-=I)"
"{"
"n=p+d*max(a*D.b,.02);"
"c=f(n);"
"if(.0>c)"
"{"
"for(int j=0;"
"j<5;"
"++j)"
"{"
"r=(p+n)*.5;"
"e=f(r);"
"if(.0>e)"
"{"
"n=r;"
"c=e;"
"}"
"else"
"{"
"p=r;"
"a=e;"
"}"
"}"
"N=normalize(vec3(f(n.rgb+D.rgg).r,f(n.rgb+D.grg).r,f(n.rgb+D.ggr).r)-c.x);"
"break;"
"}"
"p=n;"
"a=c;"
"}"
"P=p;"
"return i;"
"}"
"float C(inout vec3 p,vec3 d,vec3 c,float r)"
"{"
"vec3 q=p-c;"
"float e=dot(q,q)-r*r,a=dot(q,d);"
"if(0>e||0>a)"
"{"
"e=a*a-e;"
"if(0<e)"
"{"
"p+=max(-a-sqrt(e),.0)*d;"
"return length(a*d-q);"
"}"
"}"
"return .0;"
"}"
"vec3 Q(vec3 p)"
"{"
"vec3 a,b,c,h,i,j;"
"h=m*p;"
"i=m*h*3.;"
"j=m*i*3.;"
"a=(texture(u,h).rgb-.5)*2.*.6;"
"b=(texture(u,i).rgb-.5)*2.*.3;"
"c=(texture(u,j).rgb-.5)*2.*.1;"
"return normalize(a+b+c);"
"}"
"void main()"
"{"
"vec2 c=gl_FragCoord.xy/360.-vec2(1.78,1.);"
"vec3 p=mix(mix(v[0],v[1],v[7].g),mix(v[1],v[2],v[7].g),v[7].g)*3.,d=normalize(mix(v[3],v[4],v[7].g)),q=mix(v[5],v[6],v[7].g),r=normalize(cross(d,q)),N,P;"
"q=normalize(cross(r,d));"
"d=normalize(d+c.r*r+c.g*q);"
"q=vec3(0);"
"float e,n;"
"r=vec3(109.,14.,86.);"
"if(0<int(v[7].b)%2&&.0<C(p,d,r,9.))"
"{"
"d=normalize(d+reflect(-d,normalize(p-r))*.2);"
"l=-.2;"
"w=!w;"
"}"
"if(w)D=vec4(.05,.0,.98,.022);"
"n=T(p,d,D.a,P,N);"
"if(.0<n)"
"{"
"if(w)q=max(dot(L,N),.0)*mix(vec3(.3,.6,.9),vec3(1),smoothstep(-24.,9.,P.g))+pow(max(dot(d,reflect(L,N)),.0),7.)*.11;"
"else"
"{"
"e=T(P+L*.5,L,D.a*3.,q,q);"
"q=(1.-e)*(max(dot(L,N),.0)*mix(vec3(.8,.6,.4),vec3(1),smoothstep(-24.,9.,P.g))+pow(max(dot(d,reflect(L,N)),.0),7.)*.11);"
"}"
"r=P-v[8];"
"e=l+.5-length(r);"
"if(0<e)q+=vec3((dot(Q(P*.009),normalize(r))*.1)+.1,-.05,-.05)*smoothstep(.0,.5,e);"
"}"
"vec3 s=mix(vec3(.9,.8,.8),vec3(.8,.8,.9),d.g*111.*.02)*(dot(Q(p*.006+d*.1),d)*smoothstep(-.2,.5,-d.g)*.2+.8);"
"if(w)n=smoothstep(.0,.4,n);"
"o=vec4(mix(mix(s,vec3(1),pow(max(dot(d,L),.0),7.)),q,n),1.)-(int(gl_FragCoord.y*.5)%2+.1)*(max(max(smoothstep(.98,1.,v[7].g),smoothstep(-.02*v[9].r,.0,-v[7].g)*v[9].r),.1)+l*.02)*dot(c,c);"
"r=p;"
"e=C(r,d,v[8],l+.2);"
"if(.0<e)o.rgb-=clamp(1.-(dot(r-p,r-p)-dot(P-p,P-p))*.003,.0,1.)*(1.-pow(e/l,5))*(dot(Q((r-v[8])*.009),d)*.1+.9);"
"}"
#endif
"";
