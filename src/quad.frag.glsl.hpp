static const char *g_shader_fragment_quad = ""
#if defined(USE_LD)
"quad.frag.glsl"
#else
"#version 430\n"
"layout(location=0)uniform sampler2D s;"
"layout(location=1)uniform sampler3D x;"
"layout(location=2)uniform vec3 e[10];"
"mat3 l=mat3(.42,-.7,.58,.53,.71,.46,-.74,.12,.67);"
"out vec4 u;"
"vec4 m=vec4(.3,.0,.7,.009);"
"vec3 i=normalize(vec3(2.,.5,-1.));"
"float g=e[9].g;"
"bool f=1.<abs(e[7].b);"
"float n(vec3 c)"
"{"
"float t,m,o,i;"
"vec3 r,a,v,n;"
"if(f)"
"{"
"r=c*.02;"
"vec4 e=vec4(r,1.);"
"for(int t=0;"
"t<9;"
"++t)"
"{"
"e.rgb=clamp(e.rgb,-1.,1.)*2.-e.rgb;"
"o=dot(e.rgb,e.rgb);"
"e*=clamp(max(.824/o,.824),.0,1.);"
"e=e*vec4(vec3(-2.742),2.742)+vec4(r,1.);"
"}"
"e.rgb*=clamp(r.g+1.,.1,1.);"
"o=((length(e.rgb)-3.259)/e.a-.001475)*50.;"
"}"
"else"
"{"
"r=l*c*.007;"
"a=l*r*2.61;"
"v=l*a*2.11;"
"n=l*v*2.11;"
"t=texture(s,r.rb).r*2.61;"
"m=texture(s,a.rb).r*1.77;"
"o=texture(s,v.rb).r*.11;"
"i=texture(s,n.rb).r*.11;"
"t=i+o+pow(t,2.)+pow(m,2.);"
"o=length(c.rb)*.3;"
"o=t*(smoothstep(.0,.5,o*.0025)+.5)+c.g-6.*((sin(clamp(pow(o/10.,1.8)-1.57,-1.57,1.57))-1.)*2.+5.)*cos(clamp(.04*o,.0,3.14));"
"}"
"t=length(c-e[8].rgb);"
"if(t<g)return o+g-t;"
"return o;"
"}"
"float p(vec3 o,vec3 l,float i,out vec3 g,out vec3 f)"
"{"
"vec3 e,r;"
"float a=n(o),t,c,v=1.;"
"for(;"
"v>.0;"
"v-=i)"
"{"
"e=o+l*max(a*m.b,.02);"
"t=n(e);"
"if(.0>t)"
"{"
"for(int v=0;"
"v<5;"
"++v)"
"{"
"r=(o+e)*.5;"
"c=n(r);"
"if(.0>c)"
"{"
"e=r;"
"t=c;"
"}"
"else"
"{"
"o=r;"
"a=c;"
"}"
"}"
"f=normalize(vec3(n(e.rgb+m.rgg).r,n(e.rgb+m.grg).r,n(e.rgb+m.ggr).r)-t);"
"break;"
"}"
"o=e;"
"a=t;"
"}"
"g=o;"
"return v;"
"}"
"float d(inout vec3 c,vec3 r,vec3 v,float a)"
"{"
"vec3 t=c-v;"
"float e=dot(t,t)-a*a,o=dot(t,r);"
"if(0>e||0>o)"
"{"
"e=o*o-e;"
"if(0<e)"
"{"
"c+=max(-o-sqrt(e),.0)*r;"
"return length(o*r-t);"
"}"
"}"
"return .0;"
"}"
"vec3 b(vec3 v)"
"{"
"vec3 t,r,c,e,o,a;"
"e=l*v;"
"o=l*e*3.;"
"a=l*o*3.;"
"t=(texture(x,e).rgb-.5)*2.*.6;"
"r=(texture(x,o).rgb-.5)*2.*.3;"
"c=(texture(x,a).rgb-.5)*2.*.1;"
"return normalize(t+r+c);"
"}"
"void main()"
"{"
"vec2 s=gl_FragCoord.rg/360.-vec2(1.78,1.);"
"vec3 c=mix(mix(e[0],e[1],e[7].g),mix(e[1],e[2],e[7].g),e[7].g)*3.,o=normalize(mix(e[3],e[4],e[7].g)),r=mix(e[5],e[6],e[7].g),t=normalize(cross(o,r)),l,a;"
"r=normalize(cross(t,o));"
"o=normalize(o+s.r*t+s.g*r);"
"r=vec3(0);"
"float v,n;"
"t=vec3(109.,14.,86.);"
"if(0<int(e[7].b)%2&&.0<d(c,o,t,9.))"
"{"
"o=normalize(o+reflect(-o,normalize(c-t))*.2);"
"g=-.2;"
"f=!f;"
"}"
"if(f)m=vec4(.05,.0,.98,.022);"
"n=p(c,o,m.a,a,l);"
"if(.0<n)"
"{"
"if(f)r=max(dot(i,l),.0)*mix(vec3(.3,.6,.9),vec3(1),smoothstep(-24.,9.,a.g))+pow(max(dot(o,reflect(i,l)),.0),7.)*.11;"
"else"
"{"
"v=p(a+i*.5,i,m.a*3.,r,r);"
"r=(1.-v)*(max(dot(i,l),.0)*mix(vec3(.8,.6,.4),vec3(1),smoothstep(-24.,9.,a.g))+pow(max(dot(o,reflect(i,l)),.0),7.)*.11);"
"}"
"t=a-e[8];"
"v=g+.5-length(t);"
"if(0<v)r+=vec3(dot(b(a*.009),normalize(t))*.1+.1,-.05,-.05)*smoothstep(.0,.5,v);"
"}"
"vec3 m=mix(vec3(.9,.8,.8),vec3(.8,.8,.9),o.g*111.*.02)*(dot(b(c*.006+o*.1),o)*smoothstep(-.2,.5,-o.g)*.2+.8);"
"if(f)n=smoothstep(.0,.4,n);"
"u=vec4(mix(mix(m,vec3(1),pow(max(dot(o,i),.0),7.)),r,n),1.)-(int(gl_FragCoord.g*.5)%2+.1)*(max(max(smoothstep(.98,1.,e[7].g),smoothstep(-.02*e[9].r,.0,-e[7].g)*e[9].r),.1)+g*.02)*dot(s,s);"
"t=c;"
"v=d(t,o,e[8],g+.2);"
"if(.0<v)u.rgb-=clamp(1.-(dot(t-c,t-c)-dot(a-c,a-c))*.003,.0,1.)*(1.-pow(v/g,5))*(dot(b((t-e[8])*.009),o)*.1+.9);"
"}"
#endif
"";
